<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Check - 안면 인식 출석체크</title>
    <link rel="stylesheet" href="style.css">
    <!-- Load face-api.js from CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <script defer src="script.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <h1>학교 왔니?</h1>
            <nav>
                <button id="nav-attendance" class="active">출석 체크</button>
                <button id="nav-register">사용자 등록</button>
                <button id="nav-user-list">학급 명렬표</button>
                <button id="nav-month-status">월별 출석부</button>
                <button id="nav-data-mgmt">데이터 관리</button>
            </nav>
        </header>

        <main>
            <!-- Loading Indicator -->
            <div id="loading" class="loading-overlay">
                <div class="spinner"></div>
                <p>모델 로딩 중...</p>
            </div>

            <!-- Attendance Section -->
            <section id="attendance-section" class="active-section">
                <div class="attendance-container">
                    <div class="video-wrapper">
                        <div class="video-container">
                            <video id="attendance-video" autoplay muted></video>
                            <canvas id="attendance-canvas"></canvas>
                        </div>
                        <div id="attendance-status" class="status-message">카메라를 바라봐주세요.</div>
                    </div>
                    <div class="grid-wrapper">
                        <h3>출석 현황</h3>
                        <div id="attendance-grid" class="attendance-grid">
                            <!-- Grid items will be populated here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Registration Section -->
            <section id="register-section">
                <h2>사용자 등록</h2>

                <!-- Registration Tabs -->
                <div class="register-tabs">
                    <button id="tab-capture" class="register-tab active">📷 촬영하기</button>
                    <button id="tab-upload" class="register-tab">📁 사진 업로드</button>
                </div>

                <!-- Camera Capture Mode -->
                <div id="register-capture-mode" class="register-mode active">
                    <div class="register-layout">
                        <div class="register-media">
                            <div class="video-container">
                                <video id="register-video" autoplay muted></video>
                                <canvas id="register-canvas"></canvas>
                            </div>
                        </div>
                        <div class="register-form">
                            <div class="form-group">
                                <label for="user-number">번호</label>
                                <input type="text" id="user-number" placeholder="번호를 입력하세요 (예: 1)">
                            </div>
                            <div class="form-group">
                                <label for="user-name">이름</label>
                                <input type="text" id="user-name" placeholder="이름을 입력하세요">
                            </div>
                            <button id="btn-capture">사진 촬영 및 등록</button>
                            <div id="register-status" class="status-message"></div>
                        </div>
                    </div>
                </div>

                <!-- Photo Upload Mode -->
                <div id="register-upload-mode" class="register-mode">
                    <div class="register-layout">
                        <div class="register-media">
                            <div class="upload-preview-container">
                                <img id="upload-preview" src="" alt="업로드된 사진" style="display: none;">
                                <div id="upload-placeholder" class="upload-placeholder">
                                    <span>📷</span>
                                    <p>클릭하여 사진 선택</p>
                                </div>
                                <input type="file" id="upload-input" accept="image/*" style="display: none;">
                            </div>
                        </div>
                        <div class="register-form">
                            <div class="form-group">
                                <label for="upload-user-number">번호</label>
                                <input type="text" id="upload-user-number" placeholder="번호를 입력하세요 (예: 1)">
                            </div>
                            <div class="form-group">
                                <label for="upload-user-name">이름</label>
                                <input type="text" id="upload-user-name" placeholder="이름을 입력하세요">
                            </div>
                            <button id="btn-upload-register">사진으로 등록</button>
                            <div id="upload-status" class="status-message"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- User List Section -->
            <section id="user-list-section">
                <div class="section-header">
                    <h2>등록된 학생</h2>
                </div>
                <div class="table-container">
                    <table id="user-table">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>이름</th>
                                <th>등록일</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="user-table-body">
                            <!-- User list will be populated here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Monthly Status Section -->
            <!-- Monthly Status Section -->
            <section id="month-status-section">
                <div class="month-card">
                    <div class="month-header-wrapper">
                        <h2 id="month-title">월별 출석 현황</h2>
                        <div class="month-navigation">
                            <button id="prev-month" class="nav-arrow">◀</button>
                            <span id="current-month-display">2023년 12월</span>
                            <button id="next-month" class="nav-arrow">▶</button>
                        </div>
                    </div>
                    <div class="month-table-wrapper">
                        <div class="month-scroll-container">
                            <table id="month-table">
                                <thead id="month-table-head">
                                    <!-- Days header will be populated here -->
                                </thead>
                                <tbody id="month-table-body">
                                    <!-- Monthly data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Data Management Section -->
            <section id="data-mgmt-section">
                <h2>데이터 관리</h2>
                <div class="data-mgmt-container">
                    <div class="data-card">
                        <h3>데이터 저장</h3>
                        <p>현재 학생 명단과 출석 기록을 파일로 저장합니다.</p>
                        <button id="btn-export-data" class="btn-primary">데이터 저장 (JSON)</button>
                    </div>
                    <div class="data-card">
                        <h3>데이터 불러오기</h3>
                        <p>저장된 파일을 불러와 데이터를 복원합니다.</p>
                        <button id="btn-import-data" class="btn-secondary-action">데이터 불러오기</button>
                        <input type="file" id="file-import-data" accept=".json" style="display: none;">
                    </div>
                    <div class="data-card danger-zone">
                        <h3>데이터 초기화</h3>
                        <p>모든 데이터를 삭제하고 초기 상태로 되돌립니다.</p>
                        <button id="btn-delete-all" class="btn-danger">일괄 삭제</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Status Selection Modal -->
    <div id="status-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>출석 상태 변경</h3>
            <p id="modal-user-name" style="margin-bottom: 15px; font-weight: bold;"></p>
            <div class="status-options">
                <button class="btn-status status-present" onclick="updateStatus('present')">출석</button>
                <button class="btn-status status-late" onclick="updateStatus('late')">지각</button>
                <button class="btn-status status-early" onclick="updateStatus('early')">조퇴</button>
                <button class="btn-status status-absent" onclick="updateStatus('absent')">결석</button>
            </div>
            <button class="btn-close-modal" onclick="closeStatusModal()">닫기</button>
        </div>
    </div>

    <!-- Delete All Confirmation Modal -->
    <div id="delete-all-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 style="color: var(--error-color);">⚠️ 경고</h3>
            <p>등록된 모든 학생 데이터가 삭제됩니다.<br>이 작업은 되돌릴 수 없습니다.</p>
            <p style="margin: 15px 0;">삭제하려면 아래에 <strong>완전삭제</strong>를 입력하세요.</p>
            <input type="text" id="delete-confirm-input" placeholder="완전삭제"
                style="padding: 10px; width: 80%; margin-bottom: 20px; text-align: center;">
            <div class="status-options" style="grid-template-columns: 1fr 1fr;">
                <button id="btn-confirm-delete-all" class="btn-status status-absent" disabled
                    style="opacity: 0.5; cursor: not-allowed;">삭제</button>
                <button class="btn-close-modal" onclick="closeDeleteAllModal()">취소</button>
            </div>
        </div>
    </div>

    <!-- Individual Delete Confirmation Modal -->
    <div id="delete-user-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 style="color: var(--error-color);">⚠️ 학생 삭제</h3>
            <p>해당 학생의 모든 데이터(얼굴, 출결 기록)가 삭제됩니다.</p>
            <p style="margin: 15px 0;">삭제하려면 아래에 학생 이름(<strong id="delete-user-target-name"></strong>)을 입력하세요.</p>
            <input type="text" id="delete-user-confirm-input" placeholder="학생 이름 입력"
                style="padding: 10px; width: 80%; margin-bottom: 20px; text-align: center;">
            <div class="status-options" style="grid-template-columns: 1fr 1fr;">
                <button id="btn-confirm-delete-user" class="btn-status status-absent" disabled
                    style="opacity: 0.5; cursor: not-allowed;">삭제</button>
                <button class="btn-close-modal" onclick="closeDeleteUserModal()">취소</button>
            </div>
        </div>
    </div>

    <!-- Face Reset Modal -->
    <div id="face-reset-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-large">
            <h3>📷 얼굴 재설정</h3>
            <p id="face-reset-user-info" style="margin-bottom: 15px; font-weight: bold;"></p>

            <!-- Reset Tabs -->
            <div class="register-tabs" style="margin-bottom: 15px;">
                <button id="reset-tab-capture" class="register-tab active">📷 촬영하기</button>
                <button id="reset-tab-upload" class="register-tab">📁 사진 업로드</button>
            </div>

            <!-- Camera Capture Mode -->
            <div id="reset-capture-mode" class="reset-mode active">
                <div class="video-container" style="margin-bottom: 15px;">
                    <video id="reset-video" autoplay muted></video>
                    <canvas id="reset-canvas"></canvas>
                </div>
                <button id="btn-reset-capture" class="btn-status status-present">촬영하여 재설정</button>
            </div>

            <!-- Photo Upload Mode -->
            <div id="reset-upload-mode" class="reset-mode">
                <div class="upload-preview-container" style="margin-bottom: 15px; height: 200px;">
                    <img id="reset-upload-preview" src="" alt="업로드된 사진" style="display: none;">
                    <div id="reset-upload-placeholder" class="upload-placeholder">
                        <span>📷</span>
                        <p>클릭하여 사진 선택</p>
                    </div>
                    <input type="file" id="reset-upload-input" accept="image/*" style="display: none;">
                </div>
                <button id="btn-reset-upload" class="btn-status status-present">사진으로 재설정</button>
            </div>

            <div id="reset-status" class="status-message" style="margin: 15px 0;"></div>
            <button class="btn-close-modal" onclick="closeFaceResetModal()">닫기</button>
        </div>
    </div>

    <!-- Info Edit Modal -->
    <div id="edit-info-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>✏️ 정보 수정</h3>
            <p id="edit-info-user-info" style="margin-bottom: 15px; color: #7f8c8d;"></p>

            <div class="form-group" style="margin-bottom: 15px;">
                <label for="edit-user-number">번호</label>
                <input type="text" id="edit-user-number" placeholder="번호를 입력하세요">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="edit-user-name">이름</label>
                <input type="text" id="edit-user-name" placeholder="이름을 입력하세요">
            </div>

            <div id="edit-info-status" class="status-message" style="margin-bottom: 15px;"></div>

            <div class="status-options" style="grid-template-columns: 1fr 1fr;">
                <button id="btn-save-info" class="btn-status status-present">저장</button>
                <button class="btn-close-modal" onclick="closeEditInfoModal()">취소</button>
            </div>
        </div>
    </div>
</body>

</html>